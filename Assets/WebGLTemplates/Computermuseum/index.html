<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>%UNITY_WEB_NAME%</title>
    <link rel="icon" type="image/png" href="favicon.png"/>
    <link rel="stylesheet" href="styles/style.css"/>
    <link rel="stylesheet" href="styles/fontawesome.min.css"/>
    <link rel="stylesheet" href="styles/brands.min.css"/>
    <link rel="stylesheet" href="styles/solid.min.css"/>
  </head>

  <body>
    <header>
      <img src="logo.png"/>
    </header>

    <div id="unityContainer" style="width: %UNITY_WIDTH%px; height: %UNITY_HEIGHT%px; position: relative;">
      <div class="progress">Loading...</div>
    </div>

    <footer>
      <div class="actions">
        <a title="Fullscreen" onclick="goFullscreen(); return false;">
          <i class="fas fa-expand"></i>
        </a>
        <a href="https://github.com/boundfoxstudios/windows-developer-unity" target="_blank">
          <i class="fab fa-github"></i>
        </a>
        <a href="https://twitter.com/boundfoxstudios" target="_blank">
          <i class="fab fa-twitter"></i>
        </a>
        <a href="https://facebook.com/boundfoxstudios" target="_blank">
          <i class="fab fa-facebook"></i>
        </a>
        <a href="https://youtube.com/c/boundfox" target="_blank">
          <i class="fab fa-youtube"></i>
        </a>
      </div>

      <a href="https://boundfoxstudios.com" target="_blank" class="hvr-underline-from-center">Made with &hearts; by
        Boundfox Studios.</a>
    </footer>

    <script>
      let unityInstance;

      function startUnity() {
        unityInstance = UnityLoader.instantiate('unityContainer', '%UNITY_WEBGL_BUILD_URL%', { onProgress: unityLoadProgress });
      }

      let intervalId;
      let progressBar;

      function initializeSpinner(container) {
        if (!document.fonts.check('10px C64')) {
          return;
        }

        // PacMan loading indicator
        const pacManCharacters = [ 'Ë', 'Î', 'Ì', 'Í' ];
        let pacManIndex = 0;

        const pacManElement = document.createElement('div');
        pacManElement.className = 'spinner';
        pacManElement.innerText = pacManCharacters[pacManIndex];

        intervalId = setInterval(() => {
          pacManIndex = (pacManIndex + 1) % pacManCharacters.length;
          pacManElement.innerText = pacManCharacters[pacManIndex];
        }, 250);

        container.insertBefore(pacManElement, container.firstChild);
      }

      function unityLoadProgress(instance, progress) {
        if (!instance.Module) {
          return;
        }

        if (!instance.progressContainer) {
          instance.progressContainer = document.createElement('div');
          instance.progressContainer.className = `progress ${instance.Module.splashScreenStyle}`;

          const spinnerContainer = document.createElement('div');
          spinnerContainer.className = 'spinner-container';
          spinnerContainer.innerText = 'Loading...';
          instance.progressContainer.appendChild(spinnerContainer);

          progressBar = document.createElement('progress');
          progressBar.setAttribute('max', '1');
          instance.progressContainer.appendChild(progressBar);

          instance.container.appendChild(instance.progressContainer);

          document.fonts.ready.then(() => initializeSpinner(spinnerContainer));
        }

        if (progress === 1) {
          clearInterval(intervalId);
          instance.container.removeChild(instance.progressContainer);
        }

        if (progressBar) {
          progressBar.setAttribute('value', progress);
        }
      }

      function goFullscreen() {
        if (!unityInstance) {
          return;
        }

        unityInstance.SetFullscreen(1);
      }
    </script>
    <script src="%UNITY_WEBGL_LOADER_URL%" onload="startUnity()"></script>
  </body>
</html>
