<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>%UNITY_WEB_NAME%</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="stylesheet" href="style.css" />
  </head>
  
  <body>
    <header>
      <img src="logo.png" />
    </header>

    <div id="unityContainer" style="width: %UNITY_WIDTH%px; height: %UNITY_HEIGHT%px; position: relative;">
      <div class="progress">Loading...</div>
    </div>

    <footer>
      <a href="https://boundfoxstudios.com" target="_blank" class="hvr-underline-from-center">Made with &hearts; by Boundfox Studios.</a>
    </footer>

    <script>
      function startUnity() {
        UnityLoader.instantiate('unityContainer', 'Build/Build.json', { onProgress: unityLoadProgress });
      }

      let intervalId;
      let progressBar;
      
      function initializeSpinner(container) {
        if (!document.fonts.check('10px C64')) {
          return;
        }

         // PacMan loading indicator
          const pacManCharacters = ['Ë', 'Î', 'Ì', 'Í'];
          let pacManIndex = 0;
          
          const pacManElement = document.createElement('div');
          pacManElement.className = 'spinner';
          pacManElement.innerText = pacManCharacters[pacManIndex];

          intervalId = setInterval(() => {
            pacManIndex = (pacManIndex + 1) % pacManCharacters.length;
            pacManElement.innerText = pacManCharacters[pacManIndex];            
          }, 250);

          container.insertBefore(pacManElement, container.firstChild);
      }
      
      function unityLoadProgress(instance, progress) {
        if (!instance.Module) {
          return;
        }

        if (!instance.progressContainer) {
          instance.progressContainer = document.createElement('div');
          instance.progressContainer.className = `progress ${instance.Module.splashScreenStyle}`;
          
          const spinnerContainer = document.createElement('div');
          spinnerContainer.className = 'spinner-container';
          spinnerContainer.innerText = 'Loading...';
          instance.progressContainer.appendChild(spinnerContainer);

          progressBar = document.createElement('progress');
          progressBar.setAttribute('max', 1);
          instance.progressContainer.appendChild(progressBar);

          instance.container.appendChild(instance.progressContainer);

          document.fonts.ready.then(() => initializeSpinner(spinnerContainer));
        }

        if (progress == 1) {
          clearInterval(intervalId);
          instance.container.removeChild(instance.progressContainer);
        }

        if (progressBar) {
          progressBar.setAttribute('value', progress);
        }
      }
    </script>
    <script src="%UNITY_WEBGL_LOADER_URL%" onload="startUnity()"></script>
  </body>
</html>